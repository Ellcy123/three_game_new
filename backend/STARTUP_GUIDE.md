# ECHO Game åç«¯å¯åŠ¨æŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

åœ¨å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…ï¼š

- âœ… Node.js >= 18.0.0
- âœ… npm >= 9.0.0
- âœ… PostgreSQL >= 13
- âœ… Redis >= 6 (å¯é€‰ï¼Œä½†æ¨è)

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` åˆ° `.env` å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹ï¼š

```bash
cp .env.example .env
```

å…³é”®é…ç½®é¡¹ï¼š

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://postgres:postgres123@localhost:5432/three_brothers_game
# æˆ–è€…
DB_HOST=localhost
DB_PORT=5432
DB_NAME=three_brothers_game
DB_USER=postgres
DB_PASSWORD=your_password

# Redis é…ç½®ï¼ˆå¯é€‰ï¼‰
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ï¼‰
JWT_SECRET=your_super_secret_key_here
JWT_REFRESH_SECRET=your_refresh_secret_key_here
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼š

```bash
# æ–¹å¼ 1: ä½¿ç”¨ psql å‘½ä»¤
psql -U postgres -d three_brothers_game -f scripts/create-auth-tables.sql

# æ–¹å¼ 2: ä½¿ç”¨ npm è„šæœ¬ï¼ˆå¦‚æœå·²é…ç½®ï¼‰
npm run db:init
```

### 4. å¯åŠ¨æœåŠ¡å™¨

#### å¼€å‘æ¨¡å¼ï¼ˆå¸¦çƒ­é‡è½½ï¼‰

```bash
npm run dev
```

#### ç”Ÿäº§æ¨¡å¼

```bash
# å…ˆç¼–è¯‘
npm run build

# ç„¶åå¯åŠ¨
npm start
```

### 5. éªŒè¯æœåŠ¡å™¨

æœåŠ¡å™¨å¯åŠ¨åï¼Œè®¿é—®ä»¥ä¸‹ç«¯ç‚¹éªŒè¯ï¼š

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# API ä¿¡æ¯
curl http://localhost:3000/api

# æµ‹è¯•æ³¨å†Œï¼ˆå¯é€‰ï¼‰
curl -X POST http://localhost:3000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123"
  }'
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.ts   # PostgreSQL è¿æ¥
â”‚   â”‚   â””â”€â”€ redis.ts      # Redis è¿æ¥
â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ authController.ts
â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ errorHandler.ts
â”‚   â”œâ”€â”€ routes/           # è·¯ç”±
â”‚   â”‚   â””â”€â”€ authRoutes.ts
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ types/            # TypeScript ç±»å‹
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ socket/           # Socket.IO
â”‚   â”œâ”€â”€ app.ts            # Express åº”ç”¨é…ç½®
â”‚   â””â”€â”€ server.ts         # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ scripts/              # è„šæœ¬æ–‡ä»¶
â”‚   â””â”€â”€ create-auth-tables.sql
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env
```

## ğŸ”§ å¯ç”¨çš„ npm è„šæœ¬

```bash
# å¼€å‘
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå¸¦çƒ­é‡è½½ï¼‰

# æ„å»º
npm run build            # ç¼–è¯‘ TypeScript åˆ° JavaScript

# ç”Ÿäº§
npm start                # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

# ç±»å‹æ£€æŸ¥
npm run typecheck        # è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥

# ä»£ç è´¨é‡
npm run lint             # è¿è¡Œ ESLint
npm run lint:fix         # è‡ªåŠ¨ä¿®å¤ ESLint é”™è¯¯
npm run format           # è¿è¡Œ Prettier æ ¼å¼åŒ–

# æµ‹è¯•
npm test                 # è¿è¡Œæµ‹è¯•
npm run test:watch       # ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:coverage    # è¿è¡Œæµ‹è¯•è¦†ç›–ç‡

# æ•°æ®åº“
npm run db:init          # åˆå§‹åŒ–æ•°æ®åº“
```

## ğŸŒ API ç«¯ç‚¹

### å¥åº·æ£€æŸ¥

**GET** `/health`

è¿”å›æœåŠ¡å™¨å’Œä¾èµ–æœåŠ¡çš„å¥åº·çŠ¶æ€ã€‚

### API ä¿¡æ¯

**GET** `/api`

è¿”å› API ç‰ˆæœ¬å’Œå¯ç”¨ç«¯ç‚¹åˆ—è¡¨ã€‚

### è®¤è¯ç«¯ç‚¹

**åŸºç¡€è·¯å¾„:** `/api/v1/auth`

- **POST** `/register` - æ³¨å†Œæ–°ç”¨æˆ·
- **POST** `/login` - ç”¨æˆ·ç™»å½•
- **GET** `/verify` - éªŒè¯ Token
- **POST** `/logout` - ç”¨æˆ·ç™»å‡º

è¯¦ç»†çš„ API æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š[backend/src/controllers/README.md](src/controllers/README.md)

## ğŸ” å¯åŠ¨æ£€æŸ¥æ¸…å•

å¯åŠ¨æœåŠ¡å™¨æ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

- âœ… **åŠ è½½ç¯å¢ƒå˜é‡** - ä» `.env` æ–‡ä»¶è¯»å–é…ç½®
- âœ… **æµ‹è¯•æ•°æ®åº“è¿æ¥** - è¿æ¥ PostgreSQL å¹¶éªŒè¯
- âœ… **è¿æ¥ Redis** - å°è¯•è¿æ¥ Redisï¼ˆå¤±è´¥ä¼šè­¦å‘Šä½†ä¸ä¸­æ­¢ï¼‰
- âœ… **åˆ›å»º HTTP æœåŠ¡å™¨** - åˆ›å»º Express æœåŠ¡å™¨
- âœ… **åˆå§‹åŒ– Socket.IO** - å¯åŠ¨ WebSocket æœåŠ¡
- âœ… **ç›‘å¬ç«¯å£** - å¼€å§‹æ¥å—è¯·æ±‚

å¯åŠ¨æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š

```
========================================
  æ­£åœ¨å¯åŠ¨ ECHO Game åç«¯æœåŠ¡
========================================
ç¯å¢ƒ: development
ç«¯å£: 3000

ğŸ“¦ æ­£åœ¨è¿æ¥æ•°æ®åº“...
âœ“ æ•°æ®åº“è¿æ¥æˆåŠŸï¼
  - å½“å‰æ—¶é—´: 2024-01-01T00:00:00.000Z
  - æ•°æ®åº“ç‰ˆæœ¬: PostgreSQL 14.0
  - è¿æ¥æ± çŠ¶æ€: æ€»è¿æ¥æ•°=1, ç©ºé—²è¿æ¥=1, ç­‰å¾…è¯·æ±‚=0

ğŸ”´ æ­£åœ¨è¿æ¥ Redis...
âœ“ Redis è¿æ¥æˆåŠŸï¼

ğŸŒ æ­£åœ¨åˆ›å»º HTTP æœåŠ¡å™¨...
ğŸ”Œ æ­£åœ¨åˆå§‹åŒ– Socket.IO...
âœ… Socket.IO åˆå§‹åŒ–å®Œæˆ

========================================
  âœ¨ æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼
========================================
ğŸš€ æœåŠ¡å™¨åœ°å€: http://localhost:3000
ğŸ“ ç¯å¢ƒ: development
ğŸ”— API ç«¯ç‚¹: http://localhost:3000/api
â¤ï¸  å¥åº·æ£€æŸ¥: http://localhost:3000/health
ğŸ” è®¤è¯ API: http://localhost:3000/api/v1/auth
========================================

ğŸ’¡ æç¤º: æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨
```

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š** æœåŠ¡å™¨å¯åŠ¨æ—¶æŠ¥ "æ•°æ®åº“è¿æ¥å¤±è´¥"

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿ PostgreSQL æœåŠ¡æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥ `.env` ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®
3. éªŒè¯æ•°æ®åº“æ˜¯å¦å·²åˆ›å»ºï¼š`psql -U postgres -l`
4. å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒï¼š
   ```bash
   createdb -U postgres three_brothers_game
   ```

### é—®é¢˜ 2: Redis è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š** çœ‹åˆ° "Redis è¿æ¥å¤±è´¥" è­¦å‘Š

**è§£å†³æ–¹æ¡ˆï¼š**
1. Redis æ˜¯å¯é€‰çš„ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨æ— ç¼“å­˜æ¨¡å¼ä¸‹è¿è¡Œ
2. å¦‚æœéœ€è¦ Redisï¼Œç¡®ä¿ Redis æœåŠ¡æ­£åœ¨è¿è¡Œ
3. æ£€æŸ¥ `.env` ä¸­çš„ Redis é…ç½®
4. å¯åŠ¨ Redisï¼š
   ```bash
   # Windows (éœ€è¦å…ˆå®‰è£… Redis)
   redis-server

   # Linux/Mac
   redis-server
   ```

### é—®é¢˜ 3: ç«¯å£å·²è¢«å ç”¨

**ç—‡çŠ¶ï¼š** "Error: listen EADDRINUSE: address already in use :::3000"

**è§£å†³æ–¹æ¡ˆï¼š**
1. ä¿®æ”¹ `.env` ä¸­çš„ `PORT` é…ç½®
2. æˆ–è€…ç»ˆæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼š
   ```bash
   # Windows
   netstat -ano | findstr :3000
   taskkill /PID <PID> /F

   # Linux/Mac
   lsof -ti:3000 | xargs kill -9
   ```

### é—®é¢˜ 4: TypeScript ç¼–è¯‘é”™è¯¯

**ç—‡çŠ¶ï¼š** è¿è¡Œ `npm run build` æ—¶å‡ºç°ç±»å‹é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. è¿è¡Œç±»å‹æ£€æŸ¥æŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼š`npm run typecheck`
2. ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…ï¼š`npm install`
3. æ¸…é™¤æ„å»ºç¼“å­˜ï¼š`rm -rf dist node_modules && npm install`

### é—®é¢˜ 5: è®¤è¯å¤±è´¥

**ç—‡çŠ¶ï¼š** æ³¨å†Œæˆ–ç™»å½•æ—¶æ”¶åˆ°é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼šè¿è¡Œ `scripts/create-auth-tables.sql`
2. æ£€æŸ¥ JWT å¯†é’¥æ˜¯å¦å·²é…ç½®åœ¨ `.env` ä¸­
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ğŸ”’ å®‰å…¨æç¤º

åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œè¯·ç¡®ä¿ï¼š

- âœ… ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†é’¥ï¼ˆ`JWT_SECRET`, `JWT_REFRESH_SECRET`ï¼‰
- âœ… ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤æ•°æ®åº“
- âœ… å¯ç”¨ HTTPS
- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
- âœ… è®¾ç½® `NODE_ENV=production`
- âœ… é™åˆ¶ CORS å…è®¸çš„æº
- âœ… é…ç½®é€‚å½“çš„é™æµè§„åˆ™

## ğŸ“š æ›´å¤šæ–‡æ¡£

- [æ§åˆ¶å™¨æ–‡æ¡£](src/controllers/README.md) - API ç«¯ç‚¹è¯¦ç»†è¯´æ˜
- [æ•°æ®åº“é…ç½®](src/config/README.md) - æ•°æ®åº“å’Œ Redis é…ç½®æŒ‡å—
- [é¡¹ç›® README](../README.md) - é¡¹ç›®æ•´ä½“è¯´æ˜

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜) éƒ¨åˆ†
3. æŸ¥é˜…ç›¸å…³æ–‡æ¡£
4. åœ¨é¡¹ç›®ä»“åº“æäº¤ issue

## ğŸ‰ ä¸‹ä¸€æ­¥

æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åï¼Œä½ å¯ä»¥ï¼š

1. ä½¿ç”¨ Postman æˆ– curl æµ‹è¯• API
2. å¼€å‘å‰ç«¯åº”ç”¨å¹¶è¿æ¥åˆ°åç«¯
3. æ·»åŠ æ›´å¤šçš„ API ç«¯ç‚¹
4. é…ç½®ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
5. è®¾ç½® CI/CD æµç¨‹

ç¥ä½ å¼€å‘æ„‰å¿«ï¼ğŸš€
